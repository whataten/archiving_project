# 컴퓨터 네트워크

### 1. 개요

+ `프로토콜` : 통신 규약
  + `특징` : 요즘에는 여러 프로토콜이 이더넷-TCP/IP 기반 프로토콜로 변경되고 있다. TCP/IP는 프로토콜이라고 불리지 않고 프로토콜 스택이라고 불린다. 별도 계층에서 동작하는 프로토콜의 묶음이기 때문이다.
  + `물리적 측면` : 데이터 전송 매체, 신호 규약, 회선 규격등 (이더넷)
  + `논리적 측면` : 장치들끼리 통신하기 위한 프로토콜 규격 (TCP/IP)

+ **OSI 7계층**
  + 1 계층 (피지컬 계층)  
    + `목적` : 들어온 전기 신호를 그대로 잘 전달하는 것이 목적이다.  
    + `특징` : 1계층 장비에는 주소의 개념이 없으므로 전기 신호가 들어온 포트를 제외하고 모든 포트에 같은 전기 신호를 전송한다.  
    + `주요장비` : 허브, 리피터, 케이블. 커넥터, 트랜시버, 탭  
      + 허브, 리피터 : 네트워크 통신을 중재하는 장비
      + 케이블, 커넥터 : 케이블 본체를 구성하는 요소
      + 트랜시버 : 네트워크 인터페이스와 케이블 연결 장비
      + 탭 : 네트워크 모니터링과 패킷 분석을 위해 전기 신호를 다른 장비에 복제해주는 장비
  + 2 계층 (데이터 링크 계층)  
    + `목적` : 출발지와 도착지 주소를 확인하며 MAC 주소를 통해 내게 보낸 것이 맞는지 또는 내가 처리해야 하는지에 대해 검사 및 에러 탐지
    + `특징` : 무작정 데이터를 던지는 것이 아니라 받는 사람이 현재 데이터를 받을 수 있는지 확인하는 작업부터 해야하는데 이를 플로 컨트롤이라고 한다.
    + `주요장비` : 네트워크 인터페이스 카드, 스위치 
      + 네트워크 인터페이스 카드 : 입력되는 전기 신호를 데이터 형태로 변환하여 MAC 주소 확인
      + 스위치 : 패킷의 MAC 주소 확인 후 MAC 주소 테이블에 매핑된 포트로 전송
  + 3 계층 (네트워크 계층)
    + `목적` : IP 주소와 같은 논리적인 주소를 정의하여 데이터 통신
    + `특징` : 3 계층의 장비나 단말은 네트워크 주소 정보를 이용해 자신이 속한 네트워크와 원격지 네트워크를 구분할 수 있고 원격지 네트워크를 가려면 어디로 가야 하는지 경로를 지정하는 능력이 있다. ARP, IPv4, IPv6, NAT 프로토콜이 사용된다.
    + `주요장비` : 라우터
      + 라우터 : IP 주소 및 라우팅 테이블을 통해 최적의 경로를 찾아 해당 경로로 패킷을 전송
  + 4 계층 (트랜스포트 계층)
    + `목적` : 실제로 해당 데이터들이 정상적으로 잘 보내지도록 확인하는 역할
    + `특징` : 패킷이 유실되거나 순서가 바뀌었을 때 바로잡아주는 역할을 수행, SEQ 번호는 보내는 순서를 패킷에 명시한 번호이며 ACK 번호는 받는 순서를 패킷에 명시한 번호이다. 장치 내의 애플리케이션을 구별할 수 있도록 포트 번호를 사용하여 상위 애플리케이션을 구분한다. TCP, UDP 프로토콜이 사용된다.
    + `주요장비` : 로드 밸런서, 방화벽
      + 로드 밸런서 : 애플리케이션 구분자(포트 번호), SEQ 그리고 ACK 반호를 이용해 부하를 분산
      + 방화벽 : 보안 정책을 수립해 패킷을 통과시키거나 차단하는 기능 수행
  + 5계층 (세션 계층)
    + `목적` : 양 끝단의 응용 프로세스의 연결이 성립되도록 도와주고 연결이 안정적으로 유지되도록 관리하며 작업 완료 후에는 이 연결을 끊는 역할을 수행한다.
    + `특징` : TCP/IP 세션을 만들고 없애는 책임, 에러로 중단된 통신에 대한 에러 복구와 재전송 수행. RPC, SSH 프로토콜이 사용된다. 
    + `주요장비` : 
  + 6계층 (프레젠테이션 계층)
    + `목적` : 표현 방식이 다른 애플리케이션이나 시스템 간의 통신을 돕기 위해 하나의 통일된 구문 형식으로 변환한다.
    + `특징` : 시스템의 응용 계층에서 데이터의 형식상 차이를 다루는 부담을 덜어준다. MIME 인코딩, 암호화, 압축, 코드 변환과 같은 동작이 이루어지며 TLS, SSH 프로토콜이 사용된다.
    + `주요장비` : 
  + 7계층 (애플리케이션 계층)
    + `목적` : 애플리케이션 프로세스를 정의하고 애플리케이션 서비스를 수행한다.
    + `특징` : 네트워크 소프트웨어의 UI 부분이나 사용자 입출력 부분을 정의한다. FTP, SMTP, HTTP, TELNET 프로토콜이 사용된다.
    + `주요장비` : 

### 2. 네트워크 연결과 구성 요소

+ `인터넷 회선` : 인터넷 접속을 위해 통신사업자와 연결하는 회선
+ `전용 회선` : 가입자와 통신사업자 간에 대역폭을 보장해주는 서비스
+ `인터넷 전용 회선` : 인터넷 연결 회선에 대한 통신 대역폭을 보장해주는 상품

### 3. 네트워크 통신하기

+ `유니캐스트`
  + 출발지와 목적지가 1:1 통신
  + 실제로 사용하는 대부분의 통신은 유니캐스트를 사용한다.
+ `언노운 유니캐스트`
  + 유니캐스트여서 목적지 주소는 명시되어 있지만 네트워크에서 브로드캐스트처럼 동작할 때를 말한다.
  + 스위치가 목적지에 대한 주소를 학습하지 못한 상황이기 때문에 패킷을 모든 포트로 플러딩하여 발생한다.
+ `브로드캐스트`
  + 동일 네트워크에 존재하는 모든 호스트가 목적지
  + 유니캐스트로 통신하기 전, 주로 상대방의 정확한 위치를 알기 위해 사용한다.
  + 기본 동작은 **로컬 네트워크 내에서 모든 호스트에 패킷을 전달해야 할 때** 사용한다.
  + IPv6에는 브로드케스트가 존재하지 않고 `링크 로컬 멀티캐스트`로 대체되어 사용한다.
+ `멀티캐스트`
  + 하나의 출발지에서 다수의 특정 목적지로 데이터 전송
  + 멀티캐스트 그룹 주소를 이용해 해당 그룹에 속한 다수의 호스트로 패킷을 전송
  + 다수에게 동시에 같은 내용을 전달해야 할 때 사용
+ `애니캐스트`
  + 애니캐스트 주소가 같은 호스트들 중에서 가장 가깝거나 가장 효율적으로 서비스할 수 있는 호스트와 통신하는 방식
  + 위의 성질을 이용해 가장 가까운 DNS 서버를 찾거나 가장 가까운 게이트웨이를 찾는 기능에 사용
+ `BUM 트래픽` (**B**roadcast, **U**nkown Unicast, **M**ulticast)
  + 네트워크에서의 동작이 서로 유사
  + 네트워크상에서 불필요한 BUM 트래픽이 많아지면 네트워크 성능이 저하됨
+ `MAC`
  + MAC 주소는 각 네트워크 장비 제조업체 코드와 제조업체가 자체적으로 할당한 값으로 구성
  + BIA(Burned-In Address)라고 부르기도 함
  + 유일한 값이 아니다.
  + MAC 주소는 단말이 아닌 NIC에 종속되므로 NIC가 여러 개라면 MAC 주소도 여러 개 가질 수 있다.
  + NIC를 무차별 모드로 구성한 경우 자신의 MAC주소와 상관없이 모든 패킷을 수신합니다.
+ `IP`
  + 사용자가 변경 가능한 논리 주소이다.
  + 주소에 그룹을 의미하는 네트워크 주소와 호스트 주소로 나뉜다.
    + 네트워크 주소 : 호스트를 모은 네트워크를 지칭하는 주소로 네트워크 주소가 동일한 네트워크를 로컬 네트워크라고 한다.
    + 호스트 주소 : 하나의 네트워크 내에 존재하는 호스트를 구분하기 위한 주소
      + **호스트 주소 부분이 모두 0인 경우 해당 네트워크 주소를 의미**한다.
      + **호스트 주소 부분이 모두 1인 경우 브로드캐스트 주소를 의미**한다.
  + 127.0.0.0은 자신을 의미하는 루프백 주소로 사용된다.
  + 클래스 풀
    + A 클래스 : `255.0.0.0`, `/8` 네트워크 주소가 0으로 시작한다.
    + B 클래스 : `255.255.0.0`, `/16` 네트워크 주소가 10으로 시작한다.
    + C 클래스 : `255.255.255.0`, `/24` 네트워크 주소가 110으로 시작한다.
  + 서브넷 마스크는 IP 주소와 네트워크 주소를 구분할 때 사용하는데 2진수 숫자 1은 네트워크 주소, 0은 호스트 주소로 표시합니다.
    + 동일 네트워크 간의 통신과 서로 다른 네트워크 간의 통신을 구분하기 위해 사용합니다.
    + 서브넷 마스크와 AND 연산한 결과 네트워크 주소만 남는다.
  + 서브네팅은 네트워크-호스트 구분 기준을 사용자가 정해 클래스풀 단위의 네트워크보다 더 쪼개 사용하는 것이다.
+ `TCP`
  + 세션을 안전하게 연결하고 데이터를 분할하고 분할된 패킷이 잘 전달되었는지 확인하는 기능이 존재
  + SYN, ACK 번호를 통해 순서가 바뀌거나 손실된 패킷을 파악할 수 있다.
  + 유니캐스트 사용
  + 전이중
  + 왕복지연시간 단축
    + 윈도 사이즈를 키워 많은 패킷을 보내지만 응답은 하나만 받도록 하여 응답을 기다리는 시간을 줄입니다.
    + 윈도 사이즈를 조절하는 것을 슬라이딩 윈도라고 합니다.
    + TCP는 데이터에 유실이 발생하면 윈도 사이즈를 절반으로 줄이고 정상적인 통신이 되는 경우 서서히 하나씩 늘립니다.
  + 3방향 핸드셰이크
    + 통신 시작 전, 사전 연결작업을 진행합니다.
    + 항상 ACK 번호는 이전 SEQ 번호 + 1으로 응답
  + 웰노운 포트
    + 20, 21 : FTP
    + 22 : SSH
    + 23 : Telnet
    + 25 : SMTP
    + 53 : DNS
    + 80 : HTTP
    + 110 : POP3
    + 143 : IMAP4
    + 443 : HTTPS
    + 993 : SSL 적용 IMAP4
    + 995 : SSL 적용 POP3
+ `UDP`
  + 음성 데이터나 실시간 스트리밍 같이 시간에 민감한 프로토콜 및 애플리케이션에 사용하거나 단방향으로 다수의 단말과 통신해 응답을 받기 어려운 환경에서 사용한다.
  + 유니캐스트, 멀티캐스트, 브로드캐스트 사용
  + 반이중
  + 웰노운 포트
    + 53 : DNS
    + 67 : DHCP 서버
    + 68 : DHCP 클라이언트
    + 80 : HTTP
    + 445 : SMB
+ `ARP`
  + 상대방의 MAC 주소를 알아내기 위해 사용되는 프로토콜
  + 물리적 주소와 논리적 주소를 연결합니다.
  + ARP 브로드캐스트를 이용해 네트워크 전체에 상대방의 MAC 주소를 질의하여 IP 주소와 MAC 주소를 매핑합니다.
+ `GARP` 
  + 대상자 IP 필드에 자신의 IP 주소를 채워넣어 자신의 IP와 MAC 주소를 알릴 목적으로 사용합니다.
  + 현재 설정된 IP 주소를 네트워크에서 이미 사용하고 있는지 확인할 수 있습니다.
+ `L3 통신`, `3계층 통신`, `원격지 네트워크 통신`
  + 외부 네트워크와 통신이 필요할 때는 단말이 자신이 직접 보낼 수 없는 위치에 목적지가 있다고 판단하고 ARP 요청을 기본 게이트웨이의 IP 주소로 요청합니다.
  + 원격지 통신의 도착지 IP는 실제 도착지이고 도착지 MAC 주소는 디폴트 게이트웨이의 MAC 주소가 사용됩니다.

### 4. 스위치: 2계층 장비
+ `스위치 동작 방식`
  + 스위치를 사용하면 여러 대의 컴퓨터가 도시에 통신할 수 있다.
  + MAC 주소와 단말이 위치하는 인터페이스 정보를 매핑한 MAC 주소 테이블을 갖는다.
  + `플러딩`
    + 스위치가 허브와 같이 모든 포트로 패킷을 흘리는 동작 방식
    + MAC 주소 테이블에 매칭되는 목적지 MAC 주소 정보가 없으면 모든 포트에 같은 내용의 패킷을 전송합니다.
    + BUM 트래픽에 대해서는 플러딩 동작합니다.
  + `어드레스 러닝`
    + MAC 주소 테이블을 만들고 유지하는 과정을 말한다.
    + 패킷의 **출발지** MAC 주소와 포트 번호를 기록한다.
  + `포워딩/필터링`
    + 패킷이 스위치로 들어온 경우 도착지 MAC 주소를 확인하고 MAC 주소 테이블에서 맞는 정보가 있으면 해당 포트로 패킷을 **포워딩**합니다.
    + 이 때 다른 포트로는 해당 패킷을 보내지 않으므로 이 동작을 **필터링**이라고 합니다.
  + `VLAN`
    + 물리적 배치와 상관없이 LAN을 논리적으로 분할, **통합**하는 기술입니다.
    + 과도한 브로드캐스트로 인한 단말들의 성능 저하, 보안 향상을 위한 차단 용도와 같은 이유로 네트워크를 분리해야 합니다.
    + VLAN 간의 통신이 필요하다면 3계층 장비(라우터)가 필요합니다.
    + **포트 기반 VLAN** : 스위치의 특정 포트에 VLAN을 할당하면 할당된 VLAN에 속하게 됩니다.
    + **MAC 기반 VLAN** : 단말의 MAC 주소를 기반으로 VLAN을 할당하는 기술입니다.
  + `STP`
    + 루프를 확인하고 적절히 포트를 사용하지 못하게 만들어 루프를 예방하는 메커니즘이다.
    + 스위치는 BPDU라는 프로토콜을 통해 스위치 간에 정보를 전달하고 수집된 정보를 통해 전체 네트워크 트리를 만들어 루프 구간을 확인합니다. 
    + 네트워크 상에서 가장 높은 스위치를 선출하고 그 스위치를 통해 모든 BPDU가 교환되도록 하는데 그 스위치를 루트 스위치라고 합니다.
  + `RSTP`
    + STP의 절체시간(30 ~ 50초)가 너무 긴 문제를 해결하기 위해 절체시간을 2~3초로 단축시킨 프로토콜이다. 
    + TCP 기반 애플리케이션의 세션을 유지할 수 있다.
    + 기존 STP는 토폴로지 변경사항을 루트 스위치까지 전파한 뒤, 모든 스위치로 다시 전파하는 과정이 길지만, RSTP는 토폴로지 변경사항을 직접 모든 스위치로 전파하게한다.
  + `MST (Multiple Spanning Tree)`
    + 여러 VLAN을 그룹으로 묶고 그 그룹마다 별도의 스패닝 트리가 동작하는 방식이다. CVST와 PVST의 장점과 단점을 고루 갖는다.
    + CVST (Common Vlan Spanning Tree) : VLAN의 개수와 상관없이 하나의 스패닝 트리만 동작하므로 VLAN 마다의 최적의 동선을 적용할 수 없다.
    + PVST (Per Vlan Spanning Tree) : VLAN마다 다른 스패닝 트리 프로세스가 동작하므로 스위치에 많은 부담을 준다.

### 5. 라우터: 3계층 장비
